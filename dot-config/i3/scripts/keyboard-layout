#!/bin/bash

# –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞—Å–∫–ª–∞–¥–∫–∏
get_active_layout() {
    # –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä –∞–∫—Ç–∏–≤–Ω–æ–π –≥—Ä—É–ø–ø—ã —á–µ—Ä–µ–∑ xset -q
    group_num=$(xset -q | grep LED | awk '{print $10}')
    # –ü–µ—Ä–µ–≤–æ–¥–∏–º –∏–∑ 16-—Ä–∏—á–Ω–æ–π –≤ –¥–µ—Å—è—Ç–∏—á–Ω—É—é —Å–∏—Å—Ç–µ–º—É
    decimal=$((2#$group_num))
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é —Ä–∞—Å–∫–ª–∞–¥–∫—É (0 = –ø–µ—Ä–≤–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞, 1 = –≤—Ç–æ—Ä–∞—è)
    if [ "$decimal" -eq 8 ]; then
        echo "1"
    else
        echo "0"
    fi
}

# –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ä–∞—Å–∫–ª–∞–¥–æ–∫
layouts=($(setxkbmap -query | grep layout | awk '{print $2}' | tr ',' ' '))
active_index=$(get_active_layout)
current_layout=${layouts[$active_index]}

# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–æ–¥ —Ä–∞—Å–∫–ª–∞–¥–∫–∏ –≤ –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–π –≤–∏–¥
case "${current_layout}" in
    "us")
        layout_name="üá∫üá∏"
        #layout_name="EN" # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º
        ;;
    "ru")
        layout_name="üá∑üá∫"
        #layout_name="RU" # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º
        ;;
    *)
        layout_name="${current_layout}"
        ;;
esac

# –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
echo "${layout_name}"

# –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–∞—Å–∫–ª–∞–¥–∫–∏
case "${current_layout}" in
    "ru")
        echo "#FFFFFF"
        ;;
esac
